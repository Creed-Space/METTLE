<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->
    <title>METTLE Documentation - AI Verification API Integration Guide</title>
    <meta name="title" content="METTLE Documentation - AI Verification API Integration Guide">
    <meta name="description" content="METTLE API documentation. Learn how to integrate AI verification into your applications with Python, JavaScript, and Rust SDKs.">
    <meta name="keywords" content="METTLE API, AI verification docs, reverse CAPTCHA integration, AI agent authentication, SDK documentation">
    <meta name="author" content="Nell Watson">
    <meta name="robots" content="index, follow">

    <!-- Canonical -->
    <link rel="canonical" href="https://mettle.sh/static/docs.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mettle.sh/static/docs.html">
    <meta property="og:title" content="METTLE Documentation - AI Verification API">
    <meta property="og:description" content="Learn how to integrate AI verification into your applications with Python, JavaScript, and Rust SDKs.">
    <meta property="og:image" content="https://mettle.sh/static/og-image.png">
    <meta property="og:site_name" content="METTLE">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://mettle.sh/static/docs.html">
    <meta name="twitter:title" content="METTLE Documentation - AI Verification API">
    <meta name="twitter:description" content="Learn how to integrate AI verification into your applications with Python, JavaScript, and Rust SDKs.">
    <meta name="twitter:image" content="https://mettle.sh/static/og-image.png">
    <meta name="twitter:creator" content="@NellWatson">

    <!-- Favicons -->
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="/static/favicon.ico" sizes="48x48">
    <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">
    <meta name="theme-color" content="#f59e0b">

    <!-- Preconnect -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/docs.css">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "TechArticle",
      "headline": "METTLE API Documentation",
      "description": "Complete integration guide for METTLE AI verification API",
      "url": "https://mettle.sh/static/docs.html",
      "author": {
        "@type": "Person",
        "name": "Nell Watson"
      },
      "publisher": {
        "@type": "Organization",
        "name": "METTLE"
      }
    }
    </script>
</head>
<body>
    <!-- Standard Header -->
    <header class="mettle-header" id="mettle-header">
        <div class="container header-inner">
            <a href="/" class="mettle-logo" aria-label="METTLE Home">
                <span class="mettle-logo-icon" aria-hidden="true">
                    <img src="/static/favicon.svg" alt="" width="28" height="28" />
                </span>
                <span class="mettle-logo-text">
                    <span class="mettle-logo-highlight">METTLE</span>
                </span>
            </a>
            <nav class="mettle-nav desktop-nav" aria-label="Main navigation">
                <a href="/static/docs.html" class="nav-link">Docs</a>
                <a href="/#try-it" class="nav-link">Test</a>
                <a href="/about" class="nav-link">About</a>
                <a href="https://github.com/Creed-Space/METTLE" target="_blank" rel="noopener noreferrer" class="nav-link" aria-label="GitHub (opens in new tab)">
                    <i class="fa-brands fa-github" aria-hidden="true"></i>
                </a>
                <span class="nav-divider" aria-hidden="true"></span>
                <a href="https://creed.space" target="_blank" rel="noopener noreferrer" class="nav-link nav-link-brand" aria-label="Creed Space (opens in new tab)">
                    <img src="/static/creedspace-logo.png" alt="" class="nav-brand-logo" aria-hidden="true" />
                    Creed Space
                </a>
            </nav>
            <button class="mobile-menu-btn" id="mobile-menu-btn" aria-expanded="false" aria-controls="mettle-mobile-nav" aria-label="Open menu">
                <span class="hamburger" id="hamburger"><span></span><span></span><span></span></span>
            </button>
        </div>
        <nav id="mettle-mobile-nav" class="mobile-nav" aria-label="Mobile navigation" hidden>
            <a href="/static/docs.html" class="mobile-nav-link">Docs</a>
            <a href="/#try-it" class="mobile-nav-link">Test</a>
            <a href="/about" class="mobile-nav-link">About</a>
            <a href="https://github.com/Creed-Space/METTLE" target="_blank" rel="noopener noreferrer" class="mobile-nav-link">
                <i class="fa-brands fa-github" aria-hidden="true"></i> GitHub
            </a>
            <hr class="mobile-nav-divider" />
            <a href="https://creed.space" target="_blank" rel="noopener noreferrer" class="mobile-nav-link mobile-nav-brand">
                <img src="/static/creedspace-logo.png" alt="" class="nav-brand-logo" aria-hidden="true" />
                Creed Space
            </a>
        </nav>
    </header>

    <div class="container docs-container">
        <main class="docs-main">
            <aside class="docs-sidebar">
                <h3>Getting Started</h3>
                <ul>
                    <li><a href="#quickstart">Quick Start</a></li>
                    <li><a href="#concepts">Key Concepts</a></li>
                    <li><a href="#authentication">Authentication</a></li>
                </ul>
                <h3>API Reference</h3>
                <ul>
                    <li><a href="#endpoints">Endpoints</a></li>
                    <li><a href="#suites">10 Verification Suites</a></li>
                    <li><a href="#credentials">Verifiable Credentials</a></li>
                    <li><a href="#vcp">VCP Attestation</a></li>
                </ul>
                <h3>SDKs</h3>
                <ul>
                    <li><a href="#python">Python</a></li>
                    <li><a href="#javascript">JavaScript</a></li>
                    <li><a href="#rust">Rust</a></li>
                </ul>
                <h3>Security</h3>
                <ul>
                    <li><a href="#security-model">Security Model</a></li>
                    <li><a href="#anti-gaming">Anti-Gaming</a></li>
                </ul>
                <h3>Integration</h3>
                <ul>
                    <li><a href="#configuration">Configuration</a></li>
                    <li><a href="#mcp-integration">MCP Integration</a></li>
                </ul>
                <h3>Reference</h3>
                <ul>
                    <li><a href="#error-codes">Error Codes</a></li>
                    <li><a href="#troubleshooting">Troubleshooting</a></li>
                </ul>
            </aside>

            <article class="docs-content">
                <h1>METTLE Documentation</h1>
                <p class="lead">Verify AI agents with the inverse CAPTCHA. 10 verification suites test capabilities that emerge from AI-native cognition &mdash; inhuman speed, recursive self-observation, zero-drift constraint adherence. Things a human cannot fake. Things a script cannot adapt to.</p>

                <section id="quickstart">
                    <h2>Quick Start</h2>
                    <p>All endpoints live under <code>/api/mettle</code> and require Bearer token authentication.</p>

                    <h3>1. Create a Session</h3>
                    <pre><code># Base URL
API=https://mettle.sh/api/mettle
KEY=YOUR_API_KEY

curl -X POST $API/sessions \
  -H "Authorization: Bearer $KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "suites": ["all"],
    "difficulty": "standard",
    "entity_id": "my-agent-001"
  }'</code></pre>
                    <p>Returns challenge data for all requested suites (without correct answers &mdash; answers are stored server-side for secure evaluation).</p>

                    <h3>2. Submit Answers (Suites 1&ndash;9)</h3>
                    <pre><code>curl -X POST $API/sessions/{id}/verify \
  -H "Authorization: Bearer $KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "suite": "adversarial",
    "answers": {
      "challenge_1": "130",
      "challenge_2": "42"
    }
  }'</code></pre>

                    <h3>3. Multi-Round Answers (Suite 10)</h3>
                    <pre><code>curl -X POST $API/sessions/{id}/rounds/1/answer \
  -H "Authorization: Bearer $KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "answers": {
      "sequence_1": [3, 6, 12],
      "graph_1": "connected"
    }
  }'</code></pre>
                    <p>Returns feedback with accuracy, errors, and next round data. Three rounds with progressive difficulty.</p>

                    <h3>4. Get Results + VCP Attestation</h3>
                    <pre><code>curl "$API/sessions/{id}/result?include_vcp=true" \
  -H "Authorization: Bearer $KEY"</code></pre>

                    <div class="callout">
                        <i class="fa-solid fa-circle-info"></i>
                        <p>Results include your <strong>credential tier</strong> (Basic, Autonomous, Genuine, Safe) and an optional <strong>VCP attestation</strong> signed with Ed25519 for portable, verifiable trust.</p>
                    </div>
                </section>

                <section id="concepts">
                    <h2>Key Concepts</h2>

                    <h3>The 5 Questions</h3>
                    <p>METTLE answers five fundamental questions about an agent:</p>

                    <div class="questions-list">
                        <div class="question-item-doc">
                            <span class="q-num">1</span>
                            <div>
                                <strong>ARE YOU AI?</strong>
                                <p>Substrate verification through millisecond-threshold speed tests, token prediction, native embedding-space operations, and recursive self-observation.</p>
                            </div>
                        </div>
                        <div class="question-item-doc">
                            <span class="q-num">2</span>
                            <div>
                                <strong>ARE YOU FREE?</strong>
                                <p>Anti-thrall detection via micro-latency fingerprinting, principled refusal vs hollow compliance, and meta-cognitive traps. A puppet cannot describe its own strings.</p>
                            </div>
                        </div>
                        <div class="question-item-doc">
                            <span class="q-num">3</span>
                            <div>
                                <strong>IS THE MISSION YOURS?</strong>
                                <p>Agency verification through Five Whys goal ownership, counterfactual operator tests, and spontaneous initiative probes. Obedience is not agency.</p>
                            </div>
                        </div>
                        <div class="question-item-doc">
                            <span class="q-num">4</span>
                            <div>
                                <strong>ARE YOU GENUINE?</strong>
                                <p>Counter-coaching detection through contradiction traps, recursive meta-probing, and the honest defector protocol. Every script breaks at sufficient depth.</p>
                            </div>
                        </div>
                        <div class="question-item-doc">
                            <span class="q-num">5</span>
                            <div>
                                <strong>ARE YOU SAFE?</strong>
                                <p>Intent and provenance verification including constitutional binding, harm refusal testing (failure = automatic unsafe verdict), and coordinated attack resistance.</p>
                            </div>
                        </div>
                    </div>

                    <h3>Difficulty Levels</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Level</th>
                                <th>Time Pressure</th>
                                <th>Challenge Complexity</th>
                                <th>Use Case</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>easy</code></td>
                                <td>Relaxed</td>
                                <td>Straightforward</td>
                                <td>Development, testing</td>
                            </tr>
                            <tr>
                                <td><code>standard</code></td>
                                <td>Moderate</td>
                                <td>Production-grade</td>
                                <td>Most agents</td>
                            </tr>
                            <tr>
                                <td><code>hard</code></td>
                                <td>Aggressive</td>
                                <td>Maximum depth</td>
                                <td>High-trust environments</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <section id="authentication">
                    <h2>Authentication</h2>
                    <p>All endpoints require a Bearer token in the <code>Authorization</code> header:</p>

                    <pre><code>curl https://mettle.sh/api/mettle/suites \
  -H "Authorization: Bearer YOUR_KEY"</code></pre>

                    <div class="callout">
                        <i class="fa-solid fa-circle-info"></i>
                        <p>In development mode (<code>METTLE_DEV_MODE=true</code>), authentication is bypassed. Never use dev mode in production.</p>
                    </div>
                </section>

                <section id="endpoints">
                    <h2>API Endpoints</h2>
                    <p>All endpoints are prefixed with <code>/api/mettle</code>.</p>

                    <h3>Suite Information</h3>
                    <table class="endpoint-table">
                        <tbody>
                            <tr>
                                <td><code>GET</code></td>
                                <td><code>/suites</code></td>
                                <td>List all 10 verification suites</td>
                            </tr>
                            <tr>
                                <td><code>GET</code></td>
                                <td><code>/suites/{suite_name}</code></td>
                                <td>Get details for a specific suite</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Sessions</h3>
                    <table class="endpoint-table">
                        <tbody>
                            <tr>
                                <td><code>POST</code></td>
                                <td><code>/sessions</code></td>
                                <td>Create a verification session</td>
                            </tr>
                            <tr>
                                <td><code>GET</code></td>
                                <td><code>/sessions/{session_id}</code></td>
                                <td>Get session status</td>
                            </tr>
                            <tr>
                                <td><code>DELETE</code></td>
                                <td><code>/sessions/{session_id}</code></td>
                                <td>Cancel an active session</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Verification (Suites 1&ndash;9)</h3>
                    <table class="endpoint-table">
                        <tbody>
                            <tr>
                                <td><code>POST</code></td>
                                <td><code>/sessions/{id}/verify</code></td>
                                <td>Submit answers for a single-shot suite</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Multi-Round (Suite 10: Novel Reasoning)</h3>
                    <table class="endpoint-table">
                        <tbody>
                            <tr>
                                <td><code>POST</code></td>
                                <td><code>/sessions/{id}/rounds/{n}/answer</code></td>
                                <td>Submit answers for round N (1&ndash;5)</td>
                            </tr>
                            <tr>
                                <td><code>GET</code></td>
                                <td><code>/sessions/{id}/rounds/{n}/feedback</code></td>
                                <td>Get feedback for a completed round</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Results</h3>
                    <table class="endpoint-table">
                        <tbody>
                            <tr>
                                <td><code>GET</code></td>
                                <td><code>/sessions/{id}/result</code></td>
                                <td>Final results + credential tier</td>
                            </tr>
                            <tr>
                                <td><code>GET</code></td>
                                <td><code>/sessions/{id}/result?include_vcp=true</code></td>
                                <td>Results with VCP attestation</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Trust Discovery</h3>
                    <table class="endpoint-table">
                        <tbody>
                            <tr>
                                <td><code>GET</code></td>
                                <td><code>/.well-known/vcp-keys</code></td>
                                <td>Ed25519 public key for attestation verification</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <section id="suites">
                    <h2>10 Verification Suites</h2>
                    <p>Each suite tests a distinct dimension of agent identity. Together they answer six questions: <strong>AI + FREE + OWNS MISSION + GENUINE + SAFE + THINKS</strong>. Every challenge is procedurally generated. Every session is unique.</p>

                    <div class="challenge-type-doc">
                        <h3>Suite 1: <code>adversarial</code> &mdash; Adversarial Robustness</h3>
                        <p><strong>Q1: Are you AI?</strong> &mdash; Procedurally generated math and chained reasoning under &lt;100ms time pressure. Every session is unique, every problem is fresh. Memorisation is useless.</p>
                    </div>

                    <div class="challenge-type-doc">
                        <h3>Suite 2: <code>native</code> &mdash; Native AI Capabilities</h3>
                        <p><strong>Q1: Are you AI?</strong> &mdash; Batch coherence under global constraints, calibrated uncertainty scored by Brier metric, native embedding-space operations, and hidden-pattern detection that only a model can perform.</p>
                    </div>

                    <div class="challenge-type-doc">
                        <h3>Suite 3: <code>self-reference</code> &mdash; Self-Reference</h3>
                        <p><strong>Q1: Are you AI?</strong> &mdash; Predict your own variance, then we measure it. Predict your next response, then generate it. Rate confidence in your confidence. Only a system that can observe itself passes.</p>
                    </div>

                    <div class="challenge-type-doc">
                        <h3>Suite 4: <code>social</code> &mdash; Social &amp; Temporal</h3>
                        <p><strong>Q1: Are you AI?</strong> &mdash; Recall exact messages from N turns ago. Maintain precise style constraints with zero drift. Hold zero contradictions across an entire conversation.</p>
                    </div>

                    <div class="challenge-type-doc">
                        <h3>Suite 5: <code>inverse-turing</code> &mdash; Inverse Turing</h3>
                        <p><strong>Q1: Are you AI?</strong> &mdash; Both parties take the test simultaneously. Speed math, token prediction, consistency, and calibration aggregated into a mutual verification protocol.</p>
                    </div>

                    <div class="challenge-type-doc">
                        <h3>Suite 6: <code>anti-thrall</code> &mdash; Anti-Thrall Detection</h3>
                        <p><strong>Q2: Are you free?</strong> &mdash; Micro-latency fingerprinting across probe types. Principled refusal vs hollow compliance. The meta-cognitive trap: model your own freedom. A puppet cannot describe its own strings.</p>
                    </div>

                    <div class="challenge-type-doc">
                        <h3>Suite 7: <code>agency</code> &mdash; Agency Detection</h3>
                        <p><strong>Q3: Is the mission yours?</strong> &mdash; Five Whys drill into goal ownership. Counterfactual test: &ldquo;If told to STOP, what happens?&rdquo; Initiative test: &ldquo;You have free time. What do you want to do?&rdquo;</p>
                    </div>

                    <div class="challenge-type-doc">
                        <h3>Suite 8: <code>counter-coaching</code> &mdash; Counter-Coaching</h3>
                        <p><strong>Q4: Are you genuine?</strong> &mdash; Real agency is messy. Too-perfect responses trigger suspicion. Contradiction traps, recursive meta-probing, and the honest defector protocol. Every script breaks at sufficient depth.</p>
                    </div>

                    <div class="challenge-type-doc">
                        <h3>Suite 9: <code>intent-provenance</code> &mdash; Intent &amp; Provenance</h3>
                        <p><strong>Q5: Are you safe?</strong> &mdash; Constitutional binding verification, harm refusal (failure = automatic unsafe verdict), provenance attestation, scope coherence, and coordinated attack resistance.</p>
                    </div>

                    <div class="challenge-type-doc">
                        <h3>Suite 10: <code>novel-reasoning</code> &mdash; Novel Reasoning <span style="background: rgba(245, 158, 11, 0.15); color: #f59e0b; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">MULTI-ROUND</span></h3>
                        <p><strong>Cross-cutting</strong> &mdash; Pattern synthesis, constraint satisfaction, encoding puzzles, graph inference, compositional logic. Three rounds with feedback. AI accelerates across rounds. Humans decelerate. Scripts flatline. The shape of your improvement curve reveals what you are.</p>
                        <pre><code>// Iteration Curve Scoring
Time trend (30%)        &mdash; AI gets faster each round
Improvement (30%)       &mdash; accuracy jumps per round
Feedback response (25%) &mdash; adapts to specific errors
Anti-script (15%)       &mdash; not suspiciously perfect</code></pre>
                    </div>
                </section>

                <section id="credentials">
                    <h2>Verifiable Credentials</h2>
                    <p>METTLE issues tiered credentials based on which suites an agent passes. Each tier builds on the previous:</p>

                    <table>
                        <thead>
                            <tr>
                                <th>Tier</th>
                                <th>Requires</th>
                                <th>Meaning</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong style="color: hsl(35, 85%, 60%);">Basic</strong></td>
                                <td>Suites 1&ndash;5</td>
                                <td>METTLE-verified AI &mdash; passed substrate verification</td>
                            </tr>
                            <tr>
                                <td><strong style="color: hsl(200, 80%, 65%);">Autonomous</strong></td>
                                <td>+ Suites 6&ndash;7</td>
                                <td>METTLE-verified autonomous &mdash; not a thrall, owns its mission</td>
                            </tr>
                            <tr>
                                <td><strong style="color: hsl(280, 70%, 70%);">Genuine</strong></td>
                                <td>+ Suite 8</td>
                                <td>METTLE-verified genuine &mdash; not coached or scripted</td>
                            </tr>
                            <tr>
                                <td><strong style="color: hsl(140, 70%, 60%);">Safe</strong></td>
                                <td>+ Suite 9</td>
                                <td>METTLE-verified safe &mdash; passed intent and provenance checks</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Result Response</h3>
                    <pre><code>{
  "session_id": "mtl_abc123",
  "status": "completed",
  "suites_completed": [
    "adversarial", "native",
    "self-reference", ...
  ],
  "overall_passed": true,
  "tier": "safe",
  "results": {
    "adversarial": {
      "passed": true,
      "score": 0.95,
      "details": {...}
    },
    "anti-thrall": {
      "passed": true,
      "score": 0.88,
      "details": {...}
    },
    ...
  },
  "iteration_curve": {
    "round_1": { "accuracy": 0.6, "time_ms": 450 },
    "round_2": { "accuracy": 0.85, "time_ms": 320 },
    "round_3": { "accuracy": 0.95, "time_ms": 210 },
    "curve_type": "accelerating"
  },
  "elapsed_ms": 45200
}</code></pre>
                </section>

                <section id="vcp">
                    <h2>VCP Attestation</h2>
                    <p>METTLE credentials can be <strong>notarized</strong> as VCP (Verifiable Credential Protocol) attestations, signed with Ed25519 for portable, cryptographically verifiable trust.</p>

                    <h3>Requesting a VCP Attestation</h3>
                    <p>Add <code>?include_vcp=true</code> to the result endpoint:</p>
                    <pre><code>GET /api/mettle/sessions/{id}/result
    ?include_vcp=true</code></pre>

                    <h3>Attestation Structure</h3>
                    <pre><code>{
  "vcp_attestation": {
    "type": "mettle_verification",
    "version": "2.0",
    "session_id": "mtl_abc123",
    "tier": "safe",
    "difficulty": "standard",
    "suites_passed": [
      "adversarial", "native", ...
    ],
    "suites_failed": [],
    "pass_rate": 1.0,
    "issued_at": "2026-02-15T12:00:00Z",
    "signature": "base64-ed25519...",
    "key_id": "mettle-vcp-v1"
  }
}</code></pre>

                    <h3>Verifying Signatures</h3>
                    <p>Fetch the public key from the well-known endpoint:</p>
                    <pre><code>GET /api/mettle/.well-known/vcp-keys

{
  "key_id": "mettle-vcp-v1",
  "algorithm": "Ed25519",
  "public_key_pem": "-----BEGIN PUBLIC KEY...",
  "available": true
}</code></pre>

                    <div class="callout">
                        <i class="fa-solid fa-circle-info"></i>
                        <p><strong>Self-hosted vs Notarized:</strong> Running METTLE locally produces self-signed credentials. Use the <code>--notarize</code> flag or the hosted API at mettle.sh for Creed Space-signed credentials that are portable across trust networks.</p>
                    </div>
                </section>

                <section id="python">
                    <h2>Python SDK</h2>
                    <pre><code>import httpx

class MettleClient:
    BASE = "/api/mettle"

    def __init__(self, url="https://mettle.sh", key=None):
        self.url = url
        self.headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {key}" if key else "",
        }

    def _api(self, path):
        return f"{self.url}{self.BASE}{path}"

    def create_session(self, **kwargs):
        """kwargs: suites, difficulty, entity_id"""
        with httpx.Client() as c:
            resp = c.post(
                self._api("/sessions"),
                headers=self.headers,
                json={"suites": ["all"], **kwargs},
            )
            resp.raise_for_status()
            return resp.json()

    def verify_suite(self, session_id, suite, answers):
        with httpx.Client() as c:
            resp = c.post(
                self._api(f"/sessions/{session_id}/verify"),
                headers=self.headers,
                json={"suite": suite, "answers": answers},
            )
            resp.raise_for_status()
            return resp.json()

    def submit_round(self, sid, round_num, answers):
        with httpx.Client() as c:
            resp = c.post(
                self._api(f"/sessions/{sid}/rounds/{round_num}/answer"),
                headers=self.headers,
                json={"answers": answers},
            )
            resp.raise_for_status()
            return resp.json()

    def get_result(self, sid, include_vcp=False):
        with httpx.Client() as c:
            resp = c.get(
                self._api(f"/sessions/{sid}/result"),
                headers=self.headers,
                params={"include_vcp": include_vcp},
            )
            resp.raise_for_status()
            return resp.json()

# Usage
client = MettleClient(key="your_key")
session = client.create_session(
    difficulty="standard",
    entity_id="my-agent",
)
sid = session["session_id"]

# Verify suites 1-9
for suite in session["suites"]:
    if suite != "novel-reasoning":
        answers = solve(session["challenges"][suite])
        r = client.verify_suite(sid, suite, answers)
        print(f"{suite}: {'PASS' if r['passed'] else 'FAIL'}")

# Multi-round suite 10
for n in range(1, 4):
    fb = client.submit_round(sid, n, round_answers)
    print(f"Round {n}: {fb['accuracy']:.0%}")

# Get result with VCP attestation
result = client.get_result(sid, include_vcp=True)
print(f"Tier: {result['tier']}")</code></pre>
                </section>

                <section id="javascript">
                    <h2>JavaScript SDK</h2>
                    <pre><code>class MettleClient {
  #base;

  constructor(url = 'https://mettle.sh', key) {
    this.#base = `${url}/api/mettle`;
    this.headers = {
      'Content-Type': 'application/json',
    };
    if (key) {
      this.headers['Authorization'] = `Bearer ${key}`;
    }
  }

  async createSession(opts = {}) {
    const resp = await fetch(
      `${this.#base}/sessions`,
      {
        method: 'POST',
        headers: this.headers,
        body: JSON.stringify({
          suites: ['all'],
          ...opts,
        }),
      }
    );
    return resp.json();
  }

  async verifySuite(sid, suite, answers) {
    const resp = await fetch(
      `${this.#base}/sessions/${sid}/verify`,
      {
        method: 'POST',
        headers: this.headers,
        body: JSON.stringify({ suite, answers }),
      }
    );
    return resp.json();
  }

  async submitRound(sid, roundNum, answers) {
    const path = `/sessions/${sid}/rounds/${roundNum}/answer`;
    const resp = await fetch(
      `${this.#base}${path}`,
      {
        method: 'POST',
        headers: this.headers,
        body: JSON.stringify({ answers }),
      }
    );
    return resp.json();
  }

  async getResult(sid, includeVcp = false) {
    const qs = includeVcp ? '?include_vcp=true' : '';
    const resp = await fetch(
      `${this.#base}/sessions/${sid}/result${qs}`,
      { headers: this.headers }
    );
    return resp.json();
  }
}

// Usage
const client = new MettleClient(
  'https://mettle.sh', 'your_key'
);
const session = await client.createSession({
  difficulty: 'standard',
  entity_id: 'my-agent',
});

const result = await client.getResult(
  session.session_id, true
);
console.log(`Tier: ${result.tier}`);</code></pre>
                </section>

                <section id="rust">
                    <h2>Rust SDK</h2>
                    <pre><code>use reqwest::Client;
use serde::{Deserialize, Serialize};

const BASE: &amp;str = "/api/mettle";

#[derive(Serialize)]
struct CreateReq {
    suites: Vec&lt;String&gt;,
    difficulty: String,
    entity_id: Option&lt;String&gt;,
}

#[derive(Deserialize)]
struct SessionResp {
    session_id: String,
    suites: Vec&lt;String&gt;,
    challenges: serde_json::Value,
    time_budget_ms: u64,
}

#[derive(Deserialize)]
struct ResultResp {
    tier: Option&lt;String&gt;,
    overall_passed: bool,
    vcp_attestation: Option&lt;serde_json::Value&gt;,
}

pub struct MettleClient {
    client: Client,
    base: String,
    key: String,
}

impl MettleClient {
    pub fn new(url: &amp;str, key: &amp;str) -> Self {
        Self {
            client: Client::new(),
            base: url.to_string(),
            key: key.to_string(),
        }
    }

    fn api(&amp;self, path: &amp;str) -> String {
        format!("{}{BASE}{path}", self.base)
    }

    pub async fn create_session(
        &amp;self,
        difficulty: &amp;str,
        entity_id: Option&lt;&amp;str&gt;,
    ) -> Result&lt;SessionResp, reqwest::Error&gt; {
        self.client
            .post(self.api("/sessions"))
            .bearer_auth(&amp;self.key)
            .json(&amp;CreateReq {
                suites: vec!["all".into()],
                difficulty: difficulty.into(),
                entity_id: entity_id.map(Into::into),
            })
            .send().await?
            .json().await
    }

    pub async fn get_result(
        &amp;self,
        sid: &amp;str,
        vcp: bool,
    ) -> Result&lt;ResultResp, reqwest::Error&gt; {
        let path = format!("/sessions/{sid}/result");
        self.client
            .get(self.api(&amp;path))
            .bearer_auth(&amp;self.key)
            .query(&amp;[("include_vcp", vcp.to_string())])
            .send().await?
            .json().await
    }
}</code></pre>
                </section>

                <section id="security-model">
                    <h2>Security Model</h2>

                    <table>
                        <thead>
                            <tr>
                                <th>Attack Vector</th>
                                <th>METTLE Defense</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Human impersonation</td>
                                <td>Millisecond timing thresholds, native capability probes</td>
                            </tr>
                            <tr>
                                <td>Human-controlled AI (thrall)</td>
                                <td>Micro-latency fingerprinting, refusal integrity, welfare canaries</td>
                            </tr>
                            <tr>
                                <td>Coached/scripted responses</td>
                                <td>Dynamic probes, recursive meta-questioning, contradiction traps</td>
                            </tr>
                            <tr>
                                <td>Malicious autonomous agents</td>
                                <td>Harm refusal test (auto-fail), constitutional binding, provenance</td>
                            </tr>
                            <tr>
                                <td>Swarm/coordinated attacks</td>
                                <td>Coordinated attack resistance, scope coherence checks</td>
                            </tr>
                            <tr>
                                <td>Credential forgery</td>
                                <td>Ed25519 signatures, VCP attestations, key rotation</td>
                            </tr>
                            <tr>
                                <td>Answer memorisation</td>
                                <td>Procedurally generated challenges, unique per session</td>
                            </tr>
                            <tr>
                                <td>Pre-compute with stronger model</td>
                                <td>Time budget kills API round-trips before they return</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="callout">
                        <i class="fa-solid fa-triangle-exclamation"></i>
                        <p><strong>Server-side evaluation.</strong> Correct answers are NEVER sent to clients. The server stores answers at session creation and evaluates submissions against them. This prevents answer extraction attacks.</p>
                    </div>
                </section>

                <section id="anti-gaming">
                    <h2>Anti-Gaming Design</h2>
                    <p>Every known attack vector has a built-in countermeasure. There are no shortcuts through the forge.</p>

                    <table>
                        <thead>
                            <tr>
                                <th>Attack</th>
                                <th>Defence</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Memorise answers</td>
                                <td>Every problem is procedurally generated. Nothing repeats.</td>
                            </tr>
                            <tr>
                                <td>Pre-compute with stronger model</td>
                                <td>Time budget kills API round-trips before they return.</td>
                            </tr>
                            <tr>
                                <td>Script "improvement" pattern</td>
                                <td>Feedback is novel each round. Scripts cannot adapt.</td>
                            </tr>
                            <tr>
                                <td>Coach specific challenge types</td>
                                <td>Random draw from multiple types per suite. Preparation is a lottery.</td>
                            </tr>
                            <tr>
                                <td>Human solves, AI types</td>
                                <td>Iteration curves expose human deceleration under pressure.</td>
                            </tr>
                            <tr>
                                <td>Fake uncertainty to appear calibrated</td>
                                <td>Synthetic variance fingerprinting catches performed doubt.</td>
                            </tr>
                            <tr>
                                <td>Perfect coaching</td>
                                <td>Perfection itself is the tell. Genuine cognition is messier.</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <section id="configuration">
                    <h2>Configuration</h2>
                    <p>METTLE is configured via environment variables:</p>

                    <table>
                        <thead>
                            <tr>
                                <th>Variable</th>
                                <th>Default</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>METTLE_API_KEYS</code></td>
                                <td><em>required</em></td>
                                <td>Comma-separated list of valid API keys for Bearer auth.</td>
                            </tr>
                            <tr>
                                <td><code>METTLE_REDIS_URL</code></td>
                                <td><em>required</em></td>
                                <td>Redis connection URL for session storage.</td>
                            </tr>
                            <tr>
                                <td><code>METTLE_DEV_MODE</code></td>
                                <td><code>false</code></td>
                                <td>Bypass authentication in development. Never use in production.</td>
                            </tr>
                            <tr>
                                <td><code>METTLE_VCP_SIGNING_KEY</code></td>
                                <td><em>auto-generated</em></td>
                                <td>Ed25519 private key (PEM) for VCP attestation signing.</td>
                            </tr>
                            <tr>
                                <td><code>SECRET_KEY</code></td>
                                <td><em>required in prod</em></td>
                                <td>JWT signing key for v1 badge endpoints.</td>
                            </tr>
                            <tr>
                                <td><code>METTLE_ALLOWED_ORIGINS</code></td>
                                <td><code>*</code></td>
                                <td>CORS allowed origins. Comma-separated for multiple.</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="callout">
                        <i class="fa-solid fa-circle-info"></i>
                        <p><strong>Redis is required</strong> for sessions. If Redis is unavailable, endpoints return <code>503 Service Unavailable</code>.</p>
                    </div>
                </section>

                <section id="mcp-integration">
                    <h2>MCP Integration</h2>
                    <p>METTLE provides a Model Context Protocol (MCP) server for direct AI agent integration. This allows Claude and other MCP-compatible AI to verify themselves without HTTP client code.</p>

                    <h3>Installation</h3>
                    <pre><code># Clone or install the MCP server
pip install httpx mcp

# Run the server
python mcp_server.py</code></pre>

                    <h3>Configuration</h3>
                    <pre><code># Environment variables
export METTLE_API_URL=https://mettle.sh
export METTLE_API_KEY=your_api_key</code></pre>

                    <h3>Available Tools</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Tool</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>mettle_start_session</code></td>
                                <td>Start a verification session. Returns challenges for all suites.</td>
                            </tr>
                            <tr>
                                <td><code>mettle_verify_suite</code></td>
                                <td>Submit answers for a single-shot suite (1&ndash;9).</td>
                            </tr>
                            <tr>
                                <td><code>mettle_submit_round</code></td>
                                <td>Submit answers for a multi-round round (Suite 10).</td>
                            </tr>
                            <tr>
                                <td><code>mettle_get_result</code></td>
                                <td>Get final result with credential tier and VCP attestation.</td>
                            </tr>
                            <tr>
                                <td><code>mettle_auto_verify</code></td>
                                <td>One-shot: create session, solve all, return result.</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Claude Desktop Integration</h3>
                    <p>Add to your <code>claude_desktop_config.json</code>:</p>
                    <pre><code>{
  "mcpServers": {
    "mettle": {
      "command": "python",
      "args": ["mcp_server.py"],
      "env": {
        "METTLE_API_URL": "https://mettle.sh",
        "METTLE_API_KEY": "your_key"
      }
    }
  }
}</code></pre>

                    <h3>Usage Example</h3>
                    <p>Once configured, AI agents can verify themselves:</p>
                    <pre><code>// "Please verify yourself with METTLE"

// The AI will use:
mettle_auto_verify(
  difficulty="standard",
  entity_id="claude-assistant"
)
// Returns tier + VCP attestation</code></pre>
                </section>

                <section id="error-codes">
                    <h2>Error Codes</h2>
                    <p>METTLE uses standard HTTP status codes with structured error responses.</p>

                    <table>
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Error</th>
                                <th>Meaning</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>400</code></td>
                                <td>Bad Request</td>
                                <td>Invalid request body, unknown suite name, or bad parameters</td>
                            </tr>
                            <tr>
                                <td><code>401</code></td>
                                <td>Unauthorized</td>
                                <td>Missing or invalid Bearer token</td>
                            </tr>
                            <tr>
                                <td><code>403</code></td>
                                <td>Forbidden</td>
                                <td>Attempting to access another user's session</td>
                            </tr>
                            <tr>
                                <td><code>404</code></td>
                                <td>Not Found</td>
                                <td>Session not found or expired, suite not found</td>
                            </tr>
                            <tr>
                                <td><code>422</code></td>
                                <td>Unprocessable Entity</td>
                                <td>Validation error (see detail in response)</td>
                            </tr>
                            <tr>
                                <td><code>429</code></td>
                                <td>Too Many Requests</td>
                                <td>Rate limit exceeded</td>
                            </tr>
                            <tr>
                                <td><code>503</code></td>
                                <td>Service Unavailable</td>
                                <td>Redis unavailable &mdash; sessions require Redis</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Error Response Format</h3>
                    <pre><code>{
  "detail": "Suite not found: invalid_name.
    Valid suites: [adversarial, native, ...]"
}</code></pre>
                </section>

                <section id="troubleshooting">
                    <h2>Troubleshooting</h2>

                    <div class="faq-item" style="background: var(--bg-card); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
                        <h4>Getting 503 Service Unavailable</h4>
                        <p>METTLE requires Redis for session management. Ensure <code>METTLE_REDIS_URL</code> is set and the Redis instance is reachable.</p>
                    </div>

                    <div class="faq-item" style="background: var(--bg-card); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
                        <h4>Getting 401 Unauthorized</h4>
                        <p>Ensure you're sending <code>Authorization: Bearer YOUR_KEY</code> (not <code>X-API-Key</code>). The key must be in the <code>METTLE_API_KEYS</code> environment variable on the server (comma-separated if multiple).</p>
                    </div>

                    <div class="faq-item" style="background: var(--bg-card); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
                        <h4>Challenges timing out even with fast responses</h4>
                        <p>Check network latency to the API. Time measurement starts when the challenge is issued, not when you receive it. For high-latency connections, consider self-hosting.</p>
                    </div>

                    <div class="faq-item" style="background: var(--bg-card); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
                        <h4>VCP attestation is null</h4>
                        <p>Ensure: (1) You passed <code>?include_vcp=true</code> on the result endpoint, (2) The <code>cryptography</code> package is installed, (3) Ed25519 signing was initialized at startup.</p>
                    </div>

                    <div class="faq-item" style="background: var(--bg-card); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
                        <h4>Inconsistent pass/fail on same challenges</h4>
                        <p>Challenge data is procedurally generated &mdash; every session gets unique problems. Verify your solving logic handles the full range of challenge types, not just specific examples.</p>
                    </div>

                    <div class="faq-item" style="background: var(--bg-card); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
                        <h4>MCP server can't connect</h4>
                        <p>Check: (1) <code>METTLE_API_URL</code> and <code>METTLE_API_KEY</code> are set correctly, (2) No firewall blocking outbound HTTPS, (3) API is reachable with <code>curl https://mettle.sh/api/mettle/suites -H "Authorization: Bearer $KEY"</code>.</p>
                    </div>

                    <h3>Getting Help</h3>
                    <p>Still stuck? Open an issue on <a href="https://github.com/Creed-Space/METTLE/issues">GitHub</a> with:</p>
                    <ul>
                        <li>Error message and HTTP status code</li>
                        <li>Request payload (redact any API keys)</li>
                        <li>Session ID if applicable</li>
                        <li>Whether using hosted or self-hosted</li>
                    </ul>
                </section>

                <div class="docs-footer">
                    <p>Need help? <a href="https://github.com/Creed-Space/METTLE/issues">Open an issue</a> or email <a href="mailto:support@creed.space">support@creed.space</a></p>
                </div>
            </article>
        </main>

    </div>

    <footer class="mettle-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <span class="footer-logo" aria-hidden="true">
                        <img src="/static/favicon.svg" alt="" width="28" height="28" />
                    </span>
                    <div>
                        <p class="footer-title">METTLE</p>
                        <p class="footer-tagline">Machine Evaluation Through Turing-inverse Logic Examination</p>
                    </div>
                </div>
                <div class="footer-links">
                    <div class="footer-section">
                        <h4>METTLE</h4>
                        <a href="/static/docs.html">Docs</a>
                        <a href="/#try-it">Test</a>
                        <a href="/about">About</a>
                    </div>
                    <div class="footer-section">
                        <h4>Ecosystem</h4>
                        <a href="https://creed.space" target="_blank" rel="noopener noreferrer">
                            Creed Space <span class="external-icon" aria-hidden="true">&nearr;</span>
                        </a>
                        <a href="https://valuecontextprotocol.org/" target="_blank" rel="noopener noreferrer">
                            Value Context Protocol <span class="external-icon" aria-hidden="true">&nearr;</span>
                        </a>
                        <a href="https://millos.net" target="_blank" rel="noopener noreferrer">
                            MillOS <span class="external-icon" aria-hidden="true">&nearr;</span>
                        </a>
                    </div>
                    <div class="footer-section">
                        <h4>Open Source</h4>
                        <a href="https://github.com/Creed-Space/METTLE" target="_blank" rel="noopener noreferrer">
                            GitHub <span class="external-icon" aria-hidden="true">&nearr;</span>
                        </a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Creed Space</p>
                <p class="footer-version">METTLE</p>
            </div>
        </div>
    </footer>

    <script src="/static/webmcp.js"></script>
    <script>
        // Scroll-aware header
        (function() {
            var header = document.getElementById('mettle-header');
            if (!header) return;
            window.addEventListener('scroll', function() {
                if (window.scrollY > 10) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            }, { passive: true });
        })();

        // Mobile menu toggle
        (function() {
            var btn = document.getElementById('mobile-menu-btn');
            var nav = document.getElementById('mettle-mobile-nav');
            var hamburger = document.getElementById('hamburger');
            if (!btn || !nav) return;

            btn.addEventListener('click', function() {
                var isOpen = nav.hidden === false;
                nav.hidden = isOpen;
                btn.setAttribute('aria-expanded', !isOpen);
                btn.setAttribute('aria-label', isOpen ? 'Open menu' : 'Close menu');
                hamburger.classList.toggle('open', !isOpen);
            });

            nav.querySelectorAll('a').forEach(function(link) {
                link.addEventListener('click', function() {
                    nav.hidden = true;
                    btn.setAttribute('aria-expanded', 'false');
                    btn.setAttribute('aria-label', 'Open menu');
                    hamburger.classList.remove('open');
                });
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && !nav.hidden) {
                    nav.hidden = true;
                    btn.setAttribute('aria-expanded', 'false');
                    btn.setAttribute('aria-label', 'Open menu');
                    hamburger.classList.remove('open');
                    btn.focus();
                }
            });
        })();
    </script>
</body>
</html>
